<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TSPS: libs/ofxTSPS/src/OpenCvProcessor.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">TSPS
   &#160;<span id="projectnumber">1.3.2</span>
   </div>
   <div id="projectbrief">TSPS is a cross-platform Toolkit for Sensing People in Spaces</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_open_cv_processor_8cpp.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libs/ofxTSPS/src/OpenCvProcessor.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_open_cv_processor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *  OpenCvProcessor.cpp</span>
<a name="l00003"></a>00003 <span class="comment"> *  openTSPS</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="_open_cv_processor_8h.html">ofxTSPS/opencv/OpenCvProcessor.h</a>&quot;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="keyword">namespace </span>ofxTSPS {
<a name="l00009"></a>00009     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00010"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a1b50696027edf6e7e8f6ec84e181c138">00010</a>     <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a1b50696027edf6e7e8f6ec84e181c138">OpenCvProcessor::OpenCvProcessor</a>(){
<a name="l00011"></a>00011         <span class="comment">// capabilities</span>
<a name="l00012"></a>00012         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a7f18c31608b3f881d2f5a8d95197af4d">bCanTrackHaar</a>       = <span class="keyword">true</span>;
<a name="l00013"></a>00013         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#afe0177c5d55ddf124192a4a2b25d700d">bCanTrackContours</a>   = <span class="keyword">true</span>;
<a name="l00014"></a>00014         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a280c97f47db4c132525eae5a6f09677a">bCanTrackSkeleton</a>   = <span class="keyword">false</span>;
<a name="l00015"></a>00015         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a0a2e140a28aa1e604068549c287c8ed0">bCanTrackOpticalFlow</a> = <span class="keyword">true</span>;
<a name="l00016"></a>00016         
<a name="l00017"></a>00017         <span class="comment">// default settings</span>
<a name="l00018"></a>00018         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a239789ef8ce7d677771143c2c4e8e8ac">bTrackHaar</a> = <span class="keyword">false</span>;
<a name="l00019"></a>00019         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a98fd32f99ecfbf1ce7f7ab85847053cd">bTrackContours</a> = <span class="keyword">true</span>;
<a name="l00020"></a>00020         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a90c4b34ee69e53060442f9fb5145554c">bTrackSkeleton</a> = <span class="keyword">false</span>;
<a name="l00021"></a>00021         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a764607eb7647dc8e30096f6c32e5f737">bTrackOpticalFlow</a> = <span class="keyword">false</span>;
<a name="l00022"></a>00022         
<a name="l00023"></a>00023         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a30db61abd2f4f0592a7c83caf901d3dd">setThreshold</a>();
<a name="l00024"></a>00024         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a59b4d3d29c43cb6a88de51fbe20c368b">setBlobSettings</a>();
<a name="l00025"></a>00025         <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ab748e1f8ae10b751d45e5efce437b7f5">setOpticalflowMinMax</a>();
<a name="l00026"></a>00026         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ab821a2e2b2b18f8abf457367591f6552">setHaarPadding</a>();
<a name="l00027"></a>00027     }
<a name="l00028"></a>00028     
<a name="l00029"></a>00029     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00030"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a69d724b0018f5292abe61e01c20351d9">00030</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a69d724b0018f5292abe61e01c20351d9">OpenCvProcessor::setupProcessor</a>(){    
<a name="l00031"></a>00031         <span class="comment">//allocate images</span>
<a name="l00032"></a>00032         <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a2cdfb743768ce01c0ace4f73aa703126">resize</a>( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a> );
<a name="l00033"></a>00033         
<a name="l00034"></a>00034         opticalFlow.setCalcStep(5,5);
<a name="l00035"></a>00035         opticalFlowLastImage = opticalFlowImage;        
<a name="l00036"></a>00036         
<a name="l00037"></a>00037         <span class="comment">// setup blob tracker</span>
<a name="l00038"></a>00038         persistentTracker.setListener( <span class="keyword">this</span> );
<a name="l00039"></a>00039     }
<a name="l00040"></a>00040     
<a name="l00041"></a>00041     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00042"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a0f49e92dc7c25610936a17714de5a34c">00042</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a0f49e92dc7c25610936a17714de5a34c">OpenCvProcessor::draw</a>(){
<a name="l00043"></a>00043         <span class="keywordflow">if</span> ( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a764607eb7647dc8e30096f6c32e5f737">bTrackOpticalFlow</a> ){
<a name="l00044"></a>00044             ofSetColor(34,151,210);
<a name="l00045"></a>00045             opticalFlow.draw( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a> );
<a name="l00046"></a>00046         }
<a name="l00047"></a>00047     }
<a name="l00048"></a>00048     
<a name="l00049"></a>00049     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00050"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#aa9ede3d163e96ae57a2529a473f76b8a">00050</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#aa9ede3d163e96ae57a2529a473f76b8a">OpenCvProcessor::setCameraImage</a>( ofBaseImage &amp; image ){
<a name="l00051"></a>00051         grayImg.setFromPixels(image.getPixels(), image.getWidth(), image.getHeight());
<a name="l00052"></a>00052     }
<a name="l00053"></a>00053     
<a name="l00054"></a>00054     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00055"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a3c123dff01cb29228909b591b749b010">00055</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a3c123dff01cb29228909b591b749b010">OpenCvProcessor::captureBackground</a>( ofBaseImage &amp; image ){
<a name="l00056"></a>00056         floatBgImg.setFromPixels(image.getPixels(), image.getWidth(), image.getHeight());
<a name="l00057"></a>00057         grayBg.setFromPixels(image.getPixels(), image.getWidth(), image.getHeight());
<a name="l00058"></a>00058     }
<a name="l00059"></a>00059     
<a name="l00060"></a>00060     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00061"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a69cd81f6fceef942335023a35e7a85df">00061</a>     ofPixelsRef <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a69cd81f6fceef942335023a35e7a85df">OpenCvProcessor::progressiveBackground</a>( ofBaseImage &amp; image, <span class="keywordtype">float</span> amount ){
<a name="l00062"></a>00062         dummyImage.setFromPixels(image.getPixels(), image.getWidth(), image.getHeight());
<a name="l00063"></a>00063         floatBgImg.addWeighted( dummyImage, amount);
<a name="l00064"></a>00064         grayBg = floatBgImg;
<a name="l00065"></a>00065         <span class="keywordflow">return</span> grayBg.getPixelsRef();
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067     
<a name="l00068"></a>00068     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00069"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a6026fda8c1afa0ef6398b36edfa3f2f9">00069</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a6026fda8c1afa0ef6398b36edfa3f2f9">OpenCvProcessor::blankBackground</a>(){
<a name="l00070"></a>00070         grayBg -= grayBg;
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072     
<a name="l00073"></a>00073     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00074"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ab55549d415140270f339e9609c48be7d">00074</a>     ofPixelsRef <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ab55549d415140270f339e9609c48be7d">OpenCvProcessor::difference</a>( ofBaseImage &amp; trackingImage, <a class="code" href="namespaceofx_t_s_p_s.html#ad52e96908c9d9952d5cd1f313c0164e4">TrackingType</a> trackingType ){
<a name="l00075"></a>00075         grayDiff.setFromPixels(trackingImage.getPixels(), trackingImage.getWidth(), trackingImage.getHeight());
<a name="l00076"></a>00076         
<a name="l00077"></a>00077         <span class="comment">// subtract background</span>
<a name="l00078"></a>00078         <span class="keywordflow">if</span>(trackingType == <a class="code" href="namespaceofx_t_s_p_s.html#ad52e96908c9d9952d5cd1f313c0164e4a4d7d9fdca4236b8662eb648a0a48bf51">TRACK_ABSOLUTE</a>){
<a name="l00079"></a>00079             grayDiff.absDiff( grayBg, grayDiff );
<a name="l00080"></a>00080         } <span class="keywordflow">else</span> {
<a name="l00081"></a>00081             <span class="keywordflow">if</span>(trackingType == <a class="code" href="namespaceofx_t_s_p_s.html#ad52e96908c9d9952d5cd1f313c0164e4ac7c3dc8115b7ecabc9eb2b3efb57c24f">TRACK_LIGHT</a>){
<a name="l00082"></a>00082                 cvSub(grayBg.getCvImage(), grayDiff.getCvImage(), grayDiff.getCvImage());
<a name="l00083"></a>00083             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(trackingType == <a class="code" href="namespaceofx_t_s_p_s.html#ad52e96908c9d9952d5cd1f313c0164e4a96fc8eb706ee7e8cf903ca2991722d4a">TRACK_DARK</a>){ 
<a name="l00084"></a>00084                 cvSub(grayDiff.getCvImage(), grayBg.getCvImage(), grayDiff.getCvImage());
<a name="l00085"></a>00085             }
<a name="l00086"></a>00086             grayDiff.flagImageChanged();
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088         
<a name="l00089"></a>00089         <span class="keywordflow">return</span> grayDiff.getPixelsRef();
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091     
<a name="l00092"></a>00092     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00093"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ad23a456c0849ed6a7e736475c43aa3f4">00093</a>     ofPixelsRef <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ad23a456c0849ed6a7e736475c43aa3f4">OpenCvProcessor::process</a>( ofBaseImage &amp; trackingImage ){
<a name="l00094"></a>00094         grayDiff.setFromPixels(trackingImage.getPixels(), trackingImage.getWidth(), trackingImage.getHeight());
<a name="l00095"></a>00095         
<a name="l00096"></a>00096         <span class="comment">// reset scene</span>
<a name="l00097"></a>00097         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>-&gt;<a class="code" href="classofx_t_s_p_s_1_1_scene.html#a30f9659a7ece8549a5b0b771a35cda9b">percentCovered</a> = 0;
<a name="l00098"></a>00098         
<a name="l00099"></a>00099         <span class="keywordflow">if</span> ( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a239789ef8ce7d677771143c2c4e8e8ac">bTrackHaar</a> ){
<a name="l00100"></a>00100             <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a429198b5ac18dceac964d469970b1830">processHaar</a>( trackingImage );
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102         
<a name="l00103"></a>00103         <span class="keywordflow">if</span> ( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a764607eb7647dc8e30096f6c32e5f737">bTrackOpticalFlow</a> ){
<a name="l00104"></a>00104             <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a1dcc3ea64dbd29e4e44c02fb2576d2eb">processOpticalFlow</a>( trackingImage );
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106         
<a name="l00107"></a>00107         <span class="comment">//threshold     </span>
<a name="l00108"></a>00108         grayDiff.threshold( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a7be31f2d32b42e6e4e8c8d1f83b554c1">threshold</a> );
<a name="l00109"></a>00109         
<a name="l00110"></a>00110         <span class="comment">// find contours + track blobs</span>
<a name="l00111"></a>00111         contourFinder.findContours( grayDiff, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#af13c8cd498108765ace7d861fb0c9d52">minBlobArea</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a43edb2910eec720052890166274ee6fb">maxBlobArea</a>, 50, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ad720c3c246f05cc9807659b48fb23dc3">bFindHoles</a> );
<a name="l00112"></a>00112         persistentTracker.trackBlobs(contourFinder.blobs);
<a name="l00113"></a>00113         
<a name="l00114"></a>00114         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; persistentTracker.blobs.size(); i++){
<a name="l00115"></a>00115             ofxCvTrackedBlob blob = persistentTracker.blobs[i];
<a name="l00116"></a>00116             <a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>* p = (<a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>*) <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a448023bcb11b0ba290c2e8c68d5e4950">getTrackedPerson</a>(blob.id);
<a name="l00117"></a>00117             <span class="comment">//somehow we are not tracking this person, safeguard (shouldn&#39;t happen)</span>
<a name="l00118"></a>00118             <span class="keywordflow">if</span>(NULL == p){
<a name="l00119"></a>00119                 ofLog(OF_LOG_WARNING, <span class="stringliteral">&quot;ofxPerson::warning. encountered persistent blob without a person behind them\n&quot;</span>);
<a name="l00120"></a>00120                 <span class="keywordflow">continue</span>;
<a name="l00121"></a>00121             }
<a name="l00122"></a>00122             
<a name="l00123"></a>00123             <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>-&gt;<a class="code" href="classofx_t_s_p_s_1_1_scene.html#a30f9659a7ece8549a5b0b771a35cda9b">percentCovered</a> += blob.area;
<a name="l00124"></a>00124             
<a name="l00125"></a>00125             <span class="comment">//update this person with new blob info</span>
<a name="l00126"></a>00126             p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html#a1b1110b5ac172dafeb9d03bebb5662d4">update</a>( blob, <span class="keyword">true</span> );
<a name="l00127"></a>00127             
<a name="l00128"></a>00128             <span class="comment">//normalize simple contour</span>
<a name="l00129"></a>00129             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a2c7c62a34451427a3ab180ba0caca497">simpleContour</a>.size(); i++){
<a name="l00130"></a>00130                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a2c7c62a34451427a3ab180ba0caca497">simpleContour</a>[i].x /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>;
<a name="l00131"></a>00131                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a2c7c62a34451427a3ab180ba0caca497">simpleContour</a>[i].y /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>;
<a name="l00132"></a>00132             }
<a name="l00133"></a>00133             
<a name="l00134"></a>00134             <span class="comment">//find peak in blob (only useful with Kinect)</span>
<a name="l00135"></a>00135             CvPoint minLoc, maxLoc;
<a name="l00136"></a>00136             <span class="keywordtype">double</span> minVal = 0, maxVal = 0;
<a name="l00137"></a>00137             grayImg.setROI( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a> );
<a name="l00138"></a>00138             cvMinMaxLoc( grayImg.getCvImage(), &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc, 0);
<a name="l00139"></a>00139             
<a name="l00140"></a>00140             <span class="comment">// set highest and lowest points: x, y, VALUE stored in .z prop</span>
<a name="l00141"></a>00141             <span class="comment">// ease vals unless first time you&#39;re setting them</span>
<a name="l00142"></a>00142             <span class="keywordflow">if</span> ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.x == -1 ){
<a name="l00143"></a>00143                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.set(  p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.x + maxLoc.x,  p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.y + maxLoc.y, maxVal);
<a name="l00144"></a>00144                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.set(  p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.x + minLoc.x,  p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.y + minLoc.y, minVal);
<a name="l00145"></a>00145             } <span class="keywordflow">else</span> {
<a name="l00146"></a>00146                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.x = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.x * .7 ) + ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.x + maxLoc.x ) * .3;
<a name="l00147"></a>00147                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.y = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.y * .7 ) + ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.y + maxLoc.y ) * .3;
<a name="l00148"></a>00148                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.z = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a18e54a13e0eb8f9cfb33bfc19e9a276b">highest</a>.z * .7) + ( maxVal ) * .3;
<a name="l00149"></a>00149                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.x = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.x * .7 ) + ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.x + minLoc.x ) * .3;
<a name="l00150"></a>00150                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.y = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.y * .7 ) + ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.y + minLoc.y ) * .3;
<a name="l00151"></a>00151                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.z = ( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af041adb8cf6c9321d59915bae4a9fbac">lowest</a>.z * .7) + ( minVal ) * .3;            
<a name="l00152"></a>00152             }
<a name="l00153"></a>00153             
<a name="l00154"></a>00154             <span class="comment">// ROI for opticalflow</span>
<a name="l00155"></a>00155             ofRectangle roi = ofRectangle( p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a> );
<a name="l00156"></a>00156             roi.x *= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a>;
<a name="l00157"></a>00157             roi.y *= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a>;
<a name="l00158"></a>00158             roi.width *= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a>;
<a name="l00159"></a>00159             roi.height *= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a>;
<a name="l00160"></a>00160             
<a name="l00161"></a>00161             <span class="comment">// sum optical flow for the person</span>
<a name="l00162"></a>00162             <span class="keywordflow">if</span> ( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a764607eb7647dc8e30096f6c32e5f737">bTrackOpticalFlow</a> ){
<a name="l00163"></a>00163                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af905b7568cf3e36bc1b5cfc6805fb9c0">opticalFlowVectorAccumulation</a> = opticalFlow.flowInRegion(roi);
<a name="l00164"></a>00164             } <span class="keywordflow">else</span> {
<a name="l00165"></a>00165                 p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af905b7568cf3e36bc1b5cfc6805fb9c0">opticalFlowVectorAccumulation</a>.x = p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#af905b7568cf3e36bc1b5cfc6805fb9c0">opticalFlowVectorAccumulation</a>.y = 0;
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167             
<a name="l00168"></a>00168             <span class="comment">//detect haar patterns (faces, eyes, etc)</span>
<a name="l00169"></a>00169             <span class="keywordflow">if</span> ( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a239789ef8ce7d677771143c2c4e8e8ac">bTrackHaar</a> ){
<a name="l00170"></a>00170                 <span class="comment">// ROI for haar</span>
<a name="l00171"></a>00171                 ofRectangle roi;
<a name="l00172"></a>00172                 roi.x           = fmax( (p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.x - <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a236bf65bd910e2f63f54b72c606a2437">haarAreaPadding</a>) * <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2, 0.0f );
<a name="l00173"></a>00173                 roi.y           = fmax( (p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.y - <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a236bf65bd910e2f63f54b72c606a2437">haarAreaPadding</a>) * <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2, 0.0f );
<a name="l00174"></a>00174                 roi.width       = fmin( (p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.width  + <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a236bf65bd910e2f63f54b72c606a2437">haarAreaPadding</a>*2) * <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2, haarImage.width - roi.x );
<a name="l00175"></a>00175                 roi.height      = fmin( (p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a05aa01fd1d53d23d6146ffc2506c4c51">boundingRect</a>.height + <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a236bf65bd910e2f63f54b72c606a2437">haarAreaPadding</a>*2) * <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2, haarImage.height - roi.y );   
<a name="l00176"></a>00176                 
<a name="l00177"></a>00177                 <span class="comment">//find the region of interest, expanded by haarArea.</span>
<a name="l00178"></a>00178                 <span class="keywordtype">bool</span> haarThisFrame = <span class="keyword">false</span>;
<a name="l00179"></a>00179                 vector&lt;ofRectangle&gt; haarRects = haarTracker.getCurrentHaarRects();
<a name="l00180"></a>00180                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; haarRects.size(); i++){
<a name="l00181"></a>00181                     ofRectangle hr = haarRects[i];
<a name="l00182"></a>00182                     <span class="comment">//check to see if the haar is contained within the bounding rectangle</span>
<a name="l00183"></a>00183                     <span class="keywordflow">if</span>(hr.x &gt; roi.x &amp;&amp; hr.y &gt; roi.y &amp;&amp; hr.x+hr.width &lt; roi.x+roi.width &amp;&amp; hr.y+hr.height &lt; roi.y+roi.height){
<a name="l00184"></a>00184                         hr.x /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2;
<a name="l00185"></a>00185                         hr.y /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2;
<a name="l00186"></a>00186                         hr.width /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2;
<a name="l00187"></a>00187                         hr.height /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a> / 2;
<a name="l00188"></a>00188                         p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#aa1a0096e3d91ead6d12a5fca3e195a78">setHaarRect</a>(hr);
<a name="l00189"></a>00189                         haarThisFrame = <span class="keyword">true</span>;
<a name="l00190"></a>00190                         <span class="keywordflow">break</span>;
<a name="l00191"></a>00191                     }
<a name="l00192"></a>00192                 }
<a name="l00193"></a>00193                 <span class="keywordflow">if</span>(!haarThisFrame){
<a name="l00194"></a>00194                     p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#a98e40ed34273696242615f6383c13358">noHaarThisFrame</a>();
<a name="l00195"></a>00195                 }
<a name="l00196"></a>00196             }
<a name="l00197"></a>00197             
<a name="l00198"></a>00198             <a class="code" href="classofx_t_s_p_s_1_1_event_args.html">EventArgs</a> args;
<a name="l00199"></a>00199             args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a6f8e82d6897092f7f34c6af9dde55de8">person</a> = p;
<a name="l00200"></a>00200             args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a09c2c78decd80c58441aa3575e025e95">scene</a>  = <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>;
<a name="l00201"></a>00201             
<a name="l00202"></a>00202             ofNotifyEvent( <a class="code" href="namespaceofx_t_s_p_s.html#a657cd176865cdf8b36cbafe67bfa98f8">Events</a>().<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a8b7b64e70bf8ae4eefa541485fdb3742">personUpdated</a>, args, <span class="keyword">this</span> );
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204         
<a name="l00205"></a>00205         <span class="comment">// reset roi of image</span>
<a name="l00206"></a>00206         grayImg.setROI(0,0,<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>,<a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>);
<a name="l00207"></a>00207         
<a name="l00208"></a>00208         <span class="comment">// update scene</span>
<a name="l00209"></a>00209         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>-&gt;<a class="code" href="classofx_t_s_p_s_1_1_scene.html#a30f9659a7ece8549a5b0b771a35cda9b">percentCovered</a> /= <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>*<a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>;
<a name="l00210"></a>00210         
<a name="l00211"></a>00211         <span class="keywordflow">return</span> grayDiff.getPixelsRef();
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     
<a name="l00214"></a>00214     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00215"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a1dcc3ea64dbd29e4e44c02fb2576d2eb">00215</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a1dcc3ea64dbd29e4e44c02fb2576d2eb">OpenCvProcessor::processOpticalFlow</a>( ofBaseImage &amp; trackingImage ){
<a name="l00216"></a>00216         dummyImage.setFromPixels(trackingImage.getPixels(), trackingImage.getWidth(), trackingImage.getHeight());
<a name="l00217"></a>00217         opticalFlowImage.scaleIntoMe( dummyImage );
<a name="l00218"></a>00218         opticalFlow.calc(opticalFlowLastImage, opticalFlowImage, 11);
<a name="l00219"></a>00219         
<a name="l00220"></a>00220         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>-&gt;<a class="code" href="classofx_t_s_p_s_1_1_scene.html#ae6e5ee043f8ba35538273106a04e6575">averageMotion</a> = opticalFlow.flowInRegion(0,0,<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>,<a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>);
<a name="l00221"></a>00221         
<a name="l00222"></a>00222         <span class="comment">//store the old image</span>
<a name="l00223"></a>00223         opticalFlowLastImage = opticalFlowImage;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00227"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a429198b5ac18dceac964d469970b1830">00227</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a429198b5ac18dceac964d469970b1830">OpenCvProcessor::processHaar</a>( ofBaseImage &amp; trackingImage ){
<a name="l00228"></a>00228         dummyImage.setFromPixels(trackingImage.getPixels(), trackingImage.getWidth(), trackingImage.getHeight());
<a name="l00229"></a>00229         haarImage.scaleIntoMe( dummyImage );
<a name="l00230"></a>00230         haarTracker.findHaarObjects( haarImage );
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232     
<a name="l00233"></a>00233     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00234"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a2cdfb743768ce01c0ace4f73aa703126">00234</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a2cdfb743768ce01c0ace4f73aa703126">OpenCvProcessor::resize</a>( <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height ){
<a name="l00235"></a>00235         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>   = width;
<a name="l00236"></a>00236         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>  = height;
<a name="l00237"></a>00237         
<a name="l00238"></a>00238         grayImg.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a> );
<a name="l00239"></a>00239         grayDiff.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a> );
<a name="l00240"></a>00240         grayBg.allocate(<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>);
<a name="l00241"></a>00241         floatBgImg.allocate(<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>);
<a name="l00242"></a>00242         dummyImage.allocate(<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>);
<a name="l00243"></a>00243         opticalFlowImage.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>*<a class="code" href="classofx_t_s_p_s_1_1_processor.html#abb27915cc03a32dae496536df277332a">trackingScale</a>, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>*trackingScale ); 
<a name="l00244"></a>00244         opticalFlowLastImage.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>*trackingScale, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>*trackingScale );
<a name="l00245"></a>00245         haarImage.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>*trackingScale/2, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>*trackingScale/2 );
<a name="l00246"></a>00246         
<a name="l00247"></a>00247         <span class="comment">//set up optical flow</span>
<a name="l00248"></a>00248         opticalFlow.allocate( <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a3688ec7bd2b02c7a9aac52e9dd9c6991">tspsWidth</a>*trackingScale, <a class="code" href="classofx_t_s_p_s_1_1_processor.html#ada856ebc9c8302c4d20c66937dc502ee">tspsHeight</a>*trackingScale );
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250     
<a name="l00251"></a>00251     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00252"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ab748e1f8ae10b751d45e5efce437b7f5">00252</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#ab748e1f8ae10b751d45e5efce437b7f5">OpenCvProcessor::setOpticalflowMinMax</a>( <span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max ){
<a name="l00253"></a>00253         opticalFlow.maxVector = max;
<a name="l00254"></a>00254         opticalFlow.minVector = min;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256     
<a name="l00257"></a>00257     <span class="comment">//--------------------------------------------------------------</span>
<a name="l00258"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#afe488821c8e0224c2a7721e28128e2c2">00258</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#afe488821c8e0224c2a7721e28128e2c2">OpenCvProcessor::setHaarXMLFile</a>(<span class="keywordtype">string</span> haarFile){
<a name="l00259"></a>00259         haarFinder.setup(haarFile);
<a name="l00260"></a>00260         haarTracker.setup(&amp;haarFinder);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     
<a name="l00263"></a>00263     <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00264"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#aef12c985e86441c033d6eeee88754fbd">00264</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#aef12c985e86441c033d6eeee88754fbd">OpenCvProcessor::blobOn</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> order )
<a name="l00265"></a>00265     {
<a name="l00266"></a>00266         ofxCvTrackedBlob blob = persistentTracker.getById( <span class="keywordtype">id</span> );
<a name="l00267"></a>00267         <a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>* newPerson = <span class="keyword">new</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>(<span class="keywordtype">id</span>, order, blob);
<a name="l00268"></a>00268         
<a name="l00269"></a>00269         <a class="code" href="classofx_t_s_p_s_1_1_event_args.html">EventArgs</a> args;
<a name="l00270"></a>00270         args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a6f8e82d6897092f7f34c6af9dde55de8">person</a> = newPerson;
<a name="l00271"></a>00271         args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a09c2c78decd80c58441aa3575e025e95">scene</a>  = <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>;
<a name="l00272"></a>00272         
<a name="l00273"></a>00273         <a class="code" href="classofx_t_s_p_s_1_1_processor.html#aa81038fadcd1cd919c3b6617ef577e74">trackedPeople</a>-&gt;push_back( newPerson );
<a name="l00274"></a>00274         
<a name="l00275"></a>00275         ofNotifyEvent( <a class="code" href="namespaceofx_t_s_p_s.html#a657cd176865cdf8b36cbafe67bfa98f8">Events</a>().<a class="code" href="classofx_t_s_p_s_1_1_processor.html#a0f921c3d1bbb76356be6461e457fc8ca">personEntered</a>, args, <span class="keyword">this</span> );
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277     
<a name="l00278"></a>00278     <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00279"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a21c0f019c4010dc3198bdc318c338ea1">00279</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a21c0f019c4010dc3198bdc318c338ea1">OpenCvProcessor::blobMoved</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> order ){<span class="comment">/*not used*/</span>}
<a name="l00280"></a>00280     
<a name="l00281"></a>00281     <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00282"></a><a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a06ddd62e05c251d3d17d8ed64ada78de">00282</a>     <span class="keywordtype">void</span> <a class="code" href="classofx_t_s_p_s_1_1_open_cv_processor.html#a06ddd62e05c251d3d17d8ed64ada78de">OpenCvProcessor::blobOff</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> order )
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         <a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>* p = (<a class="code" href="classofx_t_s_p_s_1_1_open_cv_person.html">OpenCvPerson</a>*) <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a448023bcb11b0ba290c2e8c68d5e4950">getTrackedPerson</a>(<span class="keywordtype">id</span>);
<a name="l00285"></a>00285         <span class="comment">//ensure we are tracking</span>
<a name="l00286"></a>00286         <span class="keywordflow">if</span>(NULL == p){
<a name="l00287"></a>00287             ofLog(OF_LOG_WARNING, <span class="stringliteral">&quot;ofxPerson::warning. encountered persistent blob &quot;</span> + ofToString( <span class="keywordtype">id</span> ) +<span class="stringliteral">&quot; without a person behind them\n&quot;</span>);            
<a name="l00288"></a>00288             <span class="keywordflow">return</span>;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         
<a name="l00291"></a>00291         <span class="comment">//delete the object and remove it from the vector</span>
<a name="l00292"></a>00292         std::vector&lt;Person*&gt;::iterator it;
<a name="l00293"></a>00293         <span class="keywordflow">for</span>(it = <a class="code" href="classofx_t_s_p_s_1_1_processor.html#aa81038fadcd1cd919c3b6617ef577e74">trackedPeople</a>-&gt;begin(); it != <a class="code" href="classofx_t_s_p_s_1_1_processor.html#aa81038fadcd1cd919c3b6617ef577e74">trackedPeople</a>-&gt;end(); it++){
<a name="l00294"></a>00294             <span class="keywordflow">if</span>((*it)-&gt;pid == p-&gt;<a class="code" href="classofx_t_s_p_s_1_1_person.html#ac8eae9d7b57c10d8a58e8b07e85b6a41">pid</a>){
<a name="l00295"></a>00295                 <a class="code" href="classofx_t_s_p_s_1_1_processor.html#aa81038fadcd1cd919c3b6617ef577e74">trackedPeople</a>-&gt;erase(it);
<a name="l00296"></a>00296                 <span class="keywordflow">break</span>;
<a name="l00297"></a>00297             }
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299         
<a name="l00300"></a>00300         <a class="code" href="classofx_t_s_p_s_1_1_event_args.html">EventArgs</a> args;
<a name="l00301"></a>00301         args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a6f8e82d6897092f7f34c6af9dde55de8">person</a> = p;
<a name="l00302"></a>00302         args.<a class="code" href="classofx_t_s_p_s_1_1_event_args.html#a09c2c78decd80c58441aa3575e025e95">scene</a>  = <a class="code" href="classofx_t_s_p_s_1_1_processor.html#a87a28652da69c6e67626fcf885a5effa">scene</a>;
<a name="l00303"></a>00303         ofNotifyEvent( <a class="code" href="namespaceofx_t_s_p_s.html#a657cd176865cdf8b36cbafe67bfa98f8">Events</a>().<a class="code" href="classofx_t_s_p_s_1_1_processor.html#ad914b49cb3576f86a2af93d3e3ba1127">personWillLeave</a>, args, <span class="keyword">this</span> );
<a name="l00304"></a>00304         
<a name="l00305"></a>00305         <span class="comment">// delete pointer</span>
<a name="l00306"></a>00306         <span class="keyword">delete</span> p;
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 }
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_open_cv_processor_8cpp.html">OpenCvProcessor.cpp</a>      </li>

    <li class="footer">Generated on Tue Oct 30 2012 19:56:55 for TSPS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
